<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Builder - CareerGenie</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="/" style="text-decoration: none;">
                    <span class="logo">‚ú® CareerGenie</span>
                </a>
            </div>
            <div class="nav-links">
                <a href="/career.html">Career</a>
                <a href="/resume-builder.html" style="color: var(--primary);">Resume</a>
                <a href="/roles.html">Interview</a>
                <a href="/progress.html">Progress</a>
                <a href="/profile.html" class="btn btn-primary">My Dashboard</a>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <section style="background: var(--gradient); color: white; padding: 3rem 0 2rem; text-align: center;">
        <div class="container">
            <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">üìÑ Professional Resume Builder</h1>
            <p style="font-size: 1.2rem; opacity: 0.9;">Create stunning, ATS-optimized resumes in minutes</p>
        </div>
    </section>

    <!-- Main Content -->
    <section style="padding: 2rem 0;">
        <div class="container" style="max-width: 1400px;">
            
            <!-- Tab Navigation -->
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid var(--gray-200); flex-wrap: wrap;">
                <button onclick="showTab('builder')" id="builderTab" class="tab-btn active" style="padding: 1rem 2rem; border: none; background: none; font-weight: 600; color: var(--primary); border-bottom: 3px solid var(--primary); cursor: pointer;">
                    Build Resume
                </button>
                <button onclick="showTab('templates')" id="templatesTab" class="tab-btn" style="padding: 1rem 2rem; border: none; background: none; font-weight: 600; color: var(--gray-600); border-bottom: 3px solid transparent; cursor: pointer;">
                    Templates
                </button>
                <button onclick="showTab('saved')" id="savedTab" class="tab-btn" style="padding: 1rem 2rem; border: none; background: none; font-weight: 600; color: var(--gray-600); border-bottom: 3px solid transparent; cursor: pointer;">
                    My Resumes
                </button>
                <button onclick="showTab('analyzer')" id="analyzerTab" class="tab-btn" style="padding: 1rem 2rem; border: none; background: none; font-weight: 600; color: var(--gray-600); border-bottom: 3px solid transparent; cursor: pointer;">
                    ATS Analyzer
                </button>
            </div>

            <!-- Builder Tab -->
            <div id="builderContent" class="tab-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    
                    <!-- Form Section -->
                    <div style="background: white; padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow); max-height: 80vh; overflow-y: auto;">
                        <h2 style="margin-bottom: 1.5rem;">Resume Information</h2>
                        
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="fullName" required>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" id="email" required>
                            </div>
                            <div class="form-group">
                                <label>Phone *</label>
                                <input type="tel" id="phone" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>LinkedIn Profile</label>
                            <input type="url" id="linkedin" placeholder="https://linkedin.com/in/yourprofile">
                        </div>
                        
                        <div class="form-group">
                            <label>GitHub Profile</label>
                            <input type="url" id="github" placeholder="https://github.com/yourusername">
                        </div>
                        
                        <hr style="margin: 2rem 0; border: none; border-top: 1px solid var(--gray-200);">
                        
                        <h3 style="margin-bottom: 1rem;">Education</h3>
                        <div class="form-group">
                            <label>Degree *</label>
                            <input type="text" id="degree" placeholder="B.Tech in Computer Science">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label>College/University *</label>
                                <input type="text" id="college">
                            </div>
                            <div class="form-group">
                                <label>CGPA/Percentage</label>
                                <input type="text" id="cgpa" placeholder="8.5">
                            </div>
                        </div>
                        
                        <hr style="margin: 2rem 0; border: none; border-top: 1px solid var(--gray-200);">
                        
                        <h3 style="margin-bottom: 1rem;">Skills</h3>
                        <div class="form-group">
                            <label>Technical Skills (comma separated) *</label>
                            <textarea id="skills" rows="3" placeholder="JavaScript, Python, React, Node.js, SQL"></textarea>
                        </div>
                        
                        <hr style="margin: 2rem 0; border: none; border-top: 1px solid var(--gray-200);">
                        
                        <h3 style="margin-bottom: 1rem;">Experience (Optional)</h3>
                        <div class="form-group">
                            <label>Job Title</label>
                            <input type="text" id="jobTitle" placeholder="Software Developer">
                        </div>
                        <div class="form-group">
                            <label>Company</label>
                            <input type="text" id="company">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="jobDescription" rows="3" placeholder="Describe your responsibilities and achievements..."></textarea>
                        </div>
                        
                        <hr style="margin: 2rem 0; border: none; border-top: 1px solid var(--gray-200);">
                        
                        <h3 style="margin-bottom: 1rem;">Projects</h3>
                        <div class="form-group">
                            <label>Project Name</label>
                            <input type="text" id="projectName" placeholder="E-commerce Website">
                        </div>
                        <div class="form-group">
                            <label>Project Description</label>
                            <textarea id="projectDescription" rows="3" placeholder="Describe your project..."></textarea>
                        </div>
                        
                        <button onclick="updatePreview()" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                            Update Preview
                        </button>
                    </div>
                    
                    <!-- Preview Section -->
                    <div style="background: white; padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow); position: sticky; top: 20px;">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                            <h3>Preview</h3>
                            <button onclick="saveResume()" class="btn btn-success" style="margin-left: auto;">
                                Save Resume
                            </button>
                        </div>
                        <div id="resumePreview" style="border: 1px solid var(--gray-300); padding: 2rem; background: white; min-height: 600px; font-size: 0.9rem;">
                            <div style="text-align: center; color: var(--gray-500); padding: 4rem 2rem;">
                                Fill in your details to see the preview
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <!-- Templates Tab -->
            <div id="templatesContent" class="tab-content" style="display: none;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h2>Choose Your Template</h2>
                    <p style="color: var(--gray-600);">Select a professional template to get started</p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem;">
                    
                    <div onclick="selectTemplate('template1')" style="background: white; border: 3px solid var(--gray-200); border-radius: var(--radius-lg); padding: 1.5rem; cursor: pointer; transition: var(--transition);" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='var(--gray-200)'">
                        <div style="background: var(--gray-100); height: 300px; border-radius: var(--radius); margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
                            üìÑ
                        </div>
                        <h3>Classic Template</h3>
                        <p style="color: var(--gray-600); font-size: 0.9rem;">Professional and clean design</p>
                    </div>

                    <div onclick="selectTemplate('template2')" style="background: white; border: 3px solid var(--gray-200); border-radius: var(--radius-lg); padding: 1.5rem; cursor: pointer; transition: var(--transition);" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='var(--gray-200)'">
                        <div style="background: var(--gray-100); height: 300px; border-radius: var(--radius); margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
                            üé®
                        </div>
                        <h3>Modern Template</h3>
                        <p style="color: var(--gray-600); font-size: 0.9rem;">Contemporary and stylish</p>
                    </div>

                    <div onclick="selectTemplate('template3')" style="background: white; border: 3px solid var(--gray-200); border-radius: var(--radius-lg); padding: 1.5rem; cursor: pointer; transition: var(--transition);" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='var(--gray-200)'">
                        <div style="background: var(--gray-100); height: 300px; border-radius: var(--radius); margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
                            üíº
                        </div>
                        <h3>Executive Template</h3>
                        <p style="color: var(--gray-600); font-size: 0.9rem;">Perfect for senior roles</p>
                    </div>

                </div>
            </div>

            <!-- Saved Resumes Tab -->
            <div id="savedContent" class="tab-content" style="display: none;">
                <h2 style="margin-bottom: 1.5rem;">My Saved Resumes</h2>
                <div id="savedResumesList"></div>
            </div>

            <!-- ATS Analyzer Tab -->
            <div id="analyzerContent" class="tab-content" style="display: none;">
                <div style="max-width: 800px; margin: 0 auto;">
                    <div style="background: white; padding: 3rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); text-align: center;">
                        <h2 style="margin-bottom: 1rem;">üîç ATS Resume Analyzer</h2>
                        <p style="color: var(--gray-600); margin-bottom: 2rem;">Upload your resume to get an ATS compatibility score and improvement suggestions</p>
                        
                        <div style="border: 2px dashed var(--gray-300); padding: 3rem; border-radius: var(--radius); margin-bottom: 2rem;">
                            <input type="file" id="resumeFile" accept=".pdf,.doc,.docx" style="display: none;" onchange="analyzeResume()">
                            <button onclick="document.getElementById('resumeFile').click()" class="btn btn-primary btn-large">
                                üìÅ Choose Resume File
                            </button>
                            <p style="color: var(--gray-500); margin-top: 1rem; font-size: 0.9rem;">Supported formats: PDF, DOC, DOCX (Max 5MB)</p>
                        </div>
                        
                        <div id="analysisResult" style="display: none;"></div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- Chatbot -->
    <button class="chatbot-button" onclick="openChatbot()">
        <span class="chatbot-icon">üí¨</span>
    </button>

    <div id="chatbotModal" class="chatbot-modal">
        <div class="chatbot-container">
            <div class="chatbot-header">
                <h3>ü§ñ CareerGenie Assistant</h3>
                <button onclick="closeChatbot()" class="close-btn">&times;</button>
            </div>
            <div id="chatMessages" class="chatbot-messages"></div>
            <div class="chatbot-input">
                <input type="text" id="chatInput" placeholder="Ask about resumes..." onkeypress="handleChatKeyPress(event)">
                <button onclick="sendMessage()" class="send-btn">Send</button>
            </div>
        </div>
    </div>

    <script src="/js/main.js"></script>
    <script>
        // Check authentication
        async function checkAuth() {
            const response = await fetch('/api/auth/check');
            const data = await response.json();
            if (!data.authenticated) {
                window.location.href = '/auth/login.html';
            }
        }
        checkAuth();

        let currentTemplate = 'template1';

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.style.color = 'var(--gray-600)';
                btn.style.borderBottom = '3px solid transparent';
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Content').style.display = 'block';
            const activeBtn = document.getElementById(tabName + 'Tab');
            activeBtn.style.color = 'var(--primary)';
            activeBtn.style.borderBottom = '3px solid var(--primary)';
            
            // Load saved resumes if that tab is selected
            if (tabName === 'saved') {
                loadSavedResumes();
            }
        }

        function selectTemplate(templateId) {
            currentTemplate = templateId;
            showTab('builder');
            updatePreview();
            alert('Template selected! Fill in your details to see the preview.');
        }

        function updatePreview() {
            const data = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                linkedin: document.getElementById('linkedin').value,
                github: document.getElementById('github').value,
                degree: document.getElementById('degree').value,
                college: document.getElementById('college').value,
                cgpa: document.getElementById('cgpa').value,
                skills: document.getElementById('skills').value,
                jobTitle: document.getElementById('jobTitle').value,
                company: document.getElementById('company').value,
                jobDescription: document.getElementById('jobDescription').value,
                projectName: document.getElementById('projectName').value,
                projectDescription: document.getElementById('projectDescription').value
            };
            
            const preview = document.getElementById('resumePreview');
            preview.innerHTML = `
                <div style="font-family: 'Times New Roman', serif;">
                    <div style="text-align: center; border-bottom: 2px solid var(--gray-800); padding-bottom: 1rem; margin-bottom: 1.5rem;">
                        <h1 style="font-size: 2rem; margin-bottom: 0.5rem; color: var(--gray-900);">${data.fullName || 'Your Name'}</h1>
                        <p style="color: var(--gray-700);">
                            ${data.email || 'email@example.com'} | ${data.phone || 'Phone'} 
                            ${data.linkedin ? `| <a href="${data.linkedin}" style="color: var(--primary);">LinkedIn</a>` : ''}
                            ${data.github ? `| <a href="${data.github}" style="color: var(--primary);">GitHub</a>` : ''}
                        </p>
                    </div>
                    
                    ${data.degree ? `
                    <div style="margin-bottom: 1.5rem;">
                        <h2 style="color: var(--gray-900); font-size: 1.3rem; border-bottom: 1px solid var(--gray-400); padding-bottom: 0.25rem; margin-bottom: 0.75rem;">EDUCATION</h2>
                        <div>
                            <strong>${data.degree}</strong><br>
                            ${data.college}${data.cgpa ? ` | CGPA: ${data.cgpa}` : ''}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${data.skills ? `
                    <div style="margin-bottom: 1.5rem;">
                        <h2 style="color: var(--gray-900); font-size: 1.3rem; border-bottom: 1px solid var(--gray-400); padding-bottom: 0.25rem; margin-bottom: 0.75rem;">SKILLS</h2>
                        <p>${data.skills}</p>
                    </div>
                    ` : ''}
                    
                    ${data.jobTitle ? `
                    <div style="margin-bottom: 1.5rem;">
                        <h2 style="color: var(--gray-900); font-size: 1.3rem; border-bottom: 1px solid var(--gray-400); padding-bottom: 0.25rem; margin-bottom: 0.75rem;">EXPERIENCE</h2>
                        <div>
                            <strong>${data.jobTitle}</strong> - ${data.company}<br>
                            <p style="margin-top: 0.5rem;">${data.jobDescription}</p>
                        </div>
                    </div>
                    ` : ''}
                    
                    ${data.projectName ? `
                    <div style="margin-bottom: 1.5rem;">
                        <h2 style="color: var(--gray-900); font-size: 1.3rem; border-bottom: 1px solid var(--gray-400); padding-bottom: 0.25rem; margin-bottom: 0.75rem;">PROJECTS</h2>
                        <div>
                            <strong>${data.projectName}</strong><br>
                            <p style="margin-top: 0.5rem;">${data.projectDescription}</p>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        async function saveResume() {
            const resumeData = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                linkedin: document.getElementById('linkedin').value,
                github: document.getElementById('github').value,
                degree: document.getElementById('degree').value,
                college: document.getElementById('college').value,
                cgpa: document.getElementById('cgpa').value,
                skills: document.getElementById('skills').value,
                jobTitle: document.getElementById('jobTitle').value,
                company: document.getElementById('company').value,
                jobDescription: document.getElementById('jobDescription').value,
                projectName: document.getElementById('projectName').value,
                projectDescription: document.getElementById('projectDescription').value
            };
            
            if (!resumeData.fullName || !resumeData.email) {
                alert('Please fill in at least Name and Email');
                return;
            }
            
            try {
                const response = await fetch('/api/resume/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ resumeData, template: currentTemplate })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úì Resume saved successfully!');
                } else {
                    alert('Failed to save resume: ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to save resume');
            }
        }

        async function loadSavedResumes() {
            const container = document.getElementById('savedResumesList');
            container.innerHTML = '<p style="text-align: center; padding: 2rem;">Loading...</p>';
            
            try {
                const response = await fetch('/api/resume/list');
                const data = await response.json();
                
                if (data.success && data.resumes.length > 0) {
                    container.innerHTML = data.resumes.map(resume => `
                        <div style="background: white; padding: 1.5rem; border-radius: var(--radius-lg); box-shadow: var(--shadow); margin-bottom: 1rem;">
                            <h3>${resume.data.fullName || 'Untitled Resume'}</h3>
                            <p style="color: var(--gray-600); font-size: 0.9rem;">Created: ${new Date(resume.createdAt).toLocaleDateString()}</p>
                            <p style="color: var(--gray-600); font-size: 0.9rem;">Template: ${resume.template}</p>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p style="text-align: center; padding: 3rem; color: var(--gray-600);">No saved resumes yet. Create your first resume!</p>';
                }
            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = '<p style="text-align: center; padding: 2rem; color: var(--danger);">Failed to load resumes</p>';
            }
        }

        async function analyzeResume() {
            const fileInput = document.getElementById('resumeFile');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const resultDiv = document.getElementById('analysisResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>Analyzing your resume...</p>';
            
            const formData = new FormData();
            formData.append('resume', file);
            
            try {
                const response = await fetch('/api/resume/analyze', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="text-align: left; margin-top: 2rem;">
                            <h3 style="color: var(--secondary); margin-bottom: 1rem;">Analysis Complete!</h3>
                            <pre style="white-space: pre-wrap; background: var(--gray-100); padding: 1.5rem; border-radius: var(--radius); line-height: 1.6;">${data.analysis}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<p style="color: var(--danger);">Analysis failed: ${data.error}</p>`;
                }
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = '<p style="color: var(--danger);">Failed to analyze resume</p>';
            }
        }
    </script>
</body>
</html>